name: Build and Test FFTP

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Install Dependencies
      run: sudo apt-get install -y gcc libssl-dev

    - name: Compile FFTP Server
      run: gcc -o fftp_server server.c -lssl -lcrypto -lpthread

    - name: Compile FFTP Client
      run: gcc -o fftp_client client.c -lssl -lcrypto -lpthread

    - name: Run Basic Tests
      run: |
        # Start the server in the background
        ./fftp_server &
        SERVER_PID=$!

        # Wait a bit to ensure the server starts
        sleep 3

        # Test the client by sending a simple command
        echo "Testing connection and command execution"
        ./fftp_client <<< "ls -l /home/user"

        # Stop the server
        kill $SERVER_PID

    - name: Upload Artifacts
      uses: actions/upload-artifact@v3
      with:
        name: fftp_binaries
        path: |
          ./fftp_server
          ./fftp_client
